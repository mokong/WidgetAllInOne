# WidgetAllInOne
iOS Widget all in one



# iOS Widget

## èƒŒæ™¯

ä¸€å¼€å§‹æ˜¯å‘ç°æ”¯ä»˜å®çš„ Widget åšçš„å¾ˆå¥½çœ‹ï¼Œæ‰“ç®—ä»¿ä½œä¸€ä¸ªï¼Œåšçš„è¿‡ç¨‹ä¸­æ‰å‘ç°ï¼ŒåŸæ¥ Widget æœ‰è¿™ä¹ˆå¤šå¥½ç©çš„åœ°æ–¹ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œè®°å½•åˆ†äº«ä¸€ä¸‹ï¼š

<!--more-->

ä½ çŸ¥é“å¦‚ä½•åˆ›å»ºç±»ä¼¼äº QQ åŒæ­¥åŠ©æ‰‹çš„ Widget å—ï¼Ÿ
<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/IMG_2049.PNG" width="30%">
</figure>

ä½ çŸ¥é“ç±»ä¼¼äºä¸œæ–¹è´¢å¯Œçš„ä¸åŒç»„ Widget æ•ˆæœæ˜¯æ€ä¹ˆå®ç°çš„å—ï¼Ÿ
<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/IMG_2050.PNG" width="30%">
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/IMG_2052.PNG" width="30%">
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/IMG_2051.PNG" width="30%">
</figure>

ä½ çŸ¥é“ä¸‹å›¾ä¸­æ”¯ä»˜å®WidgetåŠŸèƒ½æ˜¯æ€ä¹ˆå®ç°çš„å—ï¼Ÿ
<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/IMG_2053.PNG" width="24%">
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/IMG_2056.PNG" width="24%">
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/IMG_2057.PNG" width="24%">
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/IMG_2058.PNG" width="24%">
<figure>

æˆ–è€…è¿™ä¹ˆé—®ï¼Œå¯¹äºè¿™å‡ ä¸ªçš„æ¦‚å¿µï¼š`supportedFamilies`ã€`WidgetGroup`ä»¥åŠ`Configurable Widget`æ˜¯å¦çŸ¥æ™“ï¼Œå¦‚æœéƒ½çŸ¥é“ï¼Œé‚£å°±ä¸éœ€è¦çœ‹æœ¬ç¯‡æ–‡ç« äº†ã€‚

- QQ åŒæ­¥åŠ©æ‰‹çš„Widgetåªæ˜¾ç¤ºä¸€ä¸ªWidgetçš„æ•ˆæœï¼Œæ˜¯è®¾ç½®äº† Widget çš„`supportedFamilies`åªæœ‰systemMedium æ ·å¼ï¼›
- ä¸œæ–¹è´¢å¯Œçš„å¤šç»„ Widgetï¼Œæ˜¯é€šè¿‡`WidgetGroup`å®ç°çš„ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªWidgetï¼Œæ¯ä¸ª Widget éƒ½å¯ä»¥è®¾ç½®è‡ªå·±çš„å¤§ä¸­å°ï¼›åŒºåˆ†æ˜¯å¦ä½¿ç”¨äº† `WidgetGroup`ï¼Œå¯ä»¥é€šè¿‡æ»‘åŠ¨æ—¶ï¼ŒWidgeté¢„è§ˆç•Œé¢åŒæ­¥çš„æ–‡å­—æ˜¯å¦è·Ÿç€æ»‘åŠ¨æ¥åŒºåˆ†ï¼šåŒä¸€ä¸ª Widget çš„å¤§ä¸­å°ä¸åŒæ ·å¼ï¼Œæ»‘åŠ¨æ—¶é¡¶éƒ¨çš„æ ‡é¢˜å’Œæè¿°æ˜¯ä¸ä¼šåŠ¨çš„ï¼›ä¸åŒç»„çš„ Widgetï¼Œæ¯ä¸ª Widget éƒ½æœ‰è‡ªå·±çš„æ ‡é¢˜å’Œæè¿°ï¼Œæ»‘åŠ¨æ—¶ï¼Œæ–‡å­—æ˜¯è·Ÿç€ä¸€èµ·æ»‘åŠ¨çš„ã€‚
- æ”¯ä»˜å®çš„ Widgetï¼Œä½¿ç”¨äº†`Configurable Widget`ï¼Œå®šä¹‰äº†`Enum`ç±»å‹å’Œè‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œè®¾ç½®Intent çš„`Dynamic Options`å’Œ`Supports multiple values`ã€‚


## å¼€å‘

å¼€å§‹å‰çš„è¯´æ˜ï¼š
å¦‚æœè¦ç”¨åˆ° APP å’Œ Widget ä¼ å€¼é€šä¿¡ï¼Œæ¯”å¦‚æ”¯ä»˜å®ä¸­å¤©æ°”çš„æ˜¾ç¤ºï¼Œä» APP å®šä½è·å–çš„åŸå¸‚ï¼Œä¿å­˜åˆ°æœ¬åœ°ï¼Œä» Widget ä¸­è·å–åˆ°æœ¬åœ°ä¿å­˜çš„åŸå¸‚ï¼Œå†å»è·å–å¤©æ°”ã€‚è¿™ä¸­é—´çš„ä¼ å€¼éœ€è¦ APPGroupï¼Œå¦‚æœä¸éœ€è¦ APP å’Œ Widget ä¼ å€¼çš„ï¼Œåˆ™ä¸éœ€è¦è®¾ç½®APPGroupï¼›ä½†æ˜¯å¦‚æœè®¾ç½® APPGroup çš„è¯ï¼Œéœ€è¦æ³¨æ„ Widget å’Œä¸» APP çš„ APPGroup è¦ä¸€è‡´ã€‚APPGroup çš„è¯¦ç»†ä½¿ç”¨å¯å‚è€ƒ[Appä¹‹é—´çš„æ•°æ®å…±äº«â€”â€”App Groupçš„é…ç½®](https://www.jianshu.com/p/94d4106b9298)ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è¯´æ˜äº†ã€‚


### åˆ›å»º Widget

åˆ›å»º Widgetï¼Œé€‰æ‹© File -> New -> Target -> Widget Extensionã€‚

<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/create%20widget.png" width="70%">
</figure>

ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œè¾“å…¥ Widget çš„åå­—ï¼Œå–æ¶ˆå‹¾é€‰Include Configuration Intentã€‚

<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/input%20widget%20name.png" width="70%">
</figure>

ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œä¼šå‡ºç°æ˜¯å¦åˆ‡æ¢ Target çš„æç¤ºï¼Œå¦‚ä¸‹ï¼Œç‚¹å‡»Activateï¼Œåˆ‡æ¢åˆ° Widget Targetï¼›

<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/Activate.png" width="50%">
</figure>

ä¸Šé¢çš„æ­¥éª¤ç‚¹å‡» Activateæˆ–è€…å–æ¶ˆéƒ½å¯ä»¥ï¼›ç‚¹å‡» Activate æ˜¯ Xcodeä¸»åŠ¨æŠŠ Targetåˆ‡æ¢åˆ° Widgetï¼Œç‚¹å‡»å–æ¶ˆæ˜¯ä¿æŒå½“å‰ Targetã€‚éšæ—¶å¯ä»¥æ‰‹åŠ¨åˆ‡æ¢ã€‚

<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/choose%20target.png">
</figure>

è¿™æ · Widget å°±åˆ›å»ºå¥½äº†ï¼Œæ¥çœ‹ä¸‹ç›®å‰é¡¹ç›®çš„ç»“æ„ï¼Œå¦‚ä¸‹

<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/screenshot-20220511-174147.png">
</figure>

å†æ¥çœ‹ä¸‹ï¼ŒWidget ä¸­.swift æ–‡ä»¶çš„ä»£ç ï¼Œå…¥å£å’Œä»£ç†æ–¹æ³•éƒ½åœ¨è¿™ä¸ªç±»ä¸­ï¼š

å…¶ä¸­åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œå¦‚ä¸‹

- TimeLineProviderï¼Œprotocol ç±»å‹å®šä¹‰äº†ä¸‰ä¸ªå¿…é¡»å®ç°çš„æ–¹æ³•ï¼Œç”¨äº Widget çš„é»˜è®¤å±•ç¤ºå’Œä½•æ—¶åˆ·æ–°
  - `func placeholder(in context: Context) -> SimpleEntry`
  - `func getSnapshot(in context: Context, completion: @escaping (SimpleEntry) -> ())`è¿™ä¸ªæ–¹æ³•å®šä¹‰Widgeté¢„è§ˆä¸­å¦‚ä½•å±•ç¤ºï¼Œæ‰€ä»¥æä¾›é»˜è®¤å€¼è¦åœ¨è¿™é‡Œ
  - `func getTimeline(in context: Context, completion: @escaping (Timeline<Entry>) -> ())`è¿™ä¸ªæ–¹æ³•é‡Œï¼Œå†³å®š Widget ä½•æ—¶åˆ·æ–°
- TimelineEntryï¼Œè¿™ä¸ªç±»ä¹Ÿæ˜¯å¿…é¡»å®ç°çš„ï¼Œé‡Œé¢çš„ Date ç”¨äºåˆ¤æ–­åˆ·æ–°æ—¶æœºï¼Œå¦‚æœæœ‰è‡ªå®šä¹‰ Intent çš„è¯ï¼Œä¹Ÿæ˜¯ä»è¿™é‡Œä¼ å€¼åˆ° View
- Viewï¼ŒWidgetçš„ View
- Widgetï¼ŒWidget çš„ title å’Œ descriptionï¼Œä»¥åŠ supportedFamilieséƒ½åœ¨è¿™é‡Œè®¾ç½®
- PreviewProviderï¼Œè¿™ä¸ªæ˜¯SwiftUI çš„é¢„è§ˆï¼Œå³è¾¹ä¿®æ”¹è¾¹çœ‹æ•ˆæœï¼Œå¯åˆ é™¤

çœ‹å®Œä¸Šé¢å¯èƒ½è¿˜æ˜¯ä¸€å¤´é›¾æ°´ï¼Œä¸è¦ç´§ï¼Œæ¥ç€å¾€ä¸‹çœ‹ï¼Œè·Ÿç€åšä¸€ä¸¤ä¸ª Widget å°±æ˜ç™½æ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨äº†ã€‚

### QQ åŒæ­¥åŠ©æ‰‹çš„ Widget


#### WidgetUI åˆ›å»º

å…ˆæ¥åšä¸€ä¸ªæœ€ç®€å•çš„ QQ åŒæ­¥åŠ©æ‰‹çš„ Widgetï¼Œä¸‹è½½`Tutorial1`æ–‡ä»¶å¤¹ä¸­çš„é¡¹ç›®ï¼Œæ‰“å¼€ï¼Œæ–°å»º`SwiftUIView`ï¼Œå¦‚ä¸‹ï¼š
<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220601092226.png" width="70%">
</figure>

ç‚¹å‡»Nextï¼Œæ–‡ä»¶åå­—è¾“å…¥`QQSyncWidgetView`ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„é€‰ä¸­çš„ Target æ˜¯ Widget çš„ Targetï¼Œè€Œä¸æ˜¯ä¸»å·¥ç¨‹çš„ï¼Œå¦‚ä¸‹ï¼š
<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220601092644.png" width="70%">
</figure>

ç„¶åæ‰“å¼€`QQSyncWidgetView`ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

``` Swift

//
//  QQSyncWidgetView.swift
//  DemoWidgetExtension
//
//  Created by Horizon on 01/06/2022.
//

import SwiftUI

struct QQSyncWidgetView: View {
    var body: some View {
        Text(/*@START_MENU_TOKEN@*/"Hello, World!"/*@END_MENU_TOKEN@*/)
    }
}

struct QQSyncWidgetView_Previews: PreviewProvider {
    static var previews: some View {
        QQSyncWidgetView()
    }
}

```

å…¶ä¸­ï¼Œ`QQSyncWidgetView`ä¸­æ˜¯`SwiftUI` View çš„ä»£ç ï¼Œå³è¦ä¿®æ”¹å¸ƒå±€çš„åœ°æ–¹ï¼›`QQSyncWidgetView_Previews`æ˜¯æ§åˆ¶é¢„è§ˆ View çš„ï¼Œå¯ä»¥åˆ é™¤ã€‚ç„¶åæ¥çœ‹è¦å®ç°çš„ QQ åŒæ­¥åŠ©æ‰‹çš„ WidgetåŒ…å«æœ‰å“ªäº›å†…å®¹ï¼š
<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220606100905.png" width="70%">
</figure>

å¦‚ä¸Šå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼ŒèƒŒæ™¯å›¾ç‰‡ã€å·¦ä¾§æ–‡å­— Viewã€å³ä¾§æ–‡å­— Viewï¼ŒèƒŒæ™¯å›¾ç‰‡å’Œä¸¤ä¸ª View ä¹‹é—´å‰åå…³ç³»ç”¨ ZStack çš„å®ç°ï¼Œä¸¤ä¸ª View ä¹‹é—´å·¦å³å…³ç³»ç”¨ HStackï¼ŒView é‡Œé¢çš„æ–‡å­—çš„ä¸Šä¸‹å¸ƒå±€æ˜¯ VStackï¼Œæµ‹è¯•ç”¨çš„èµ„æºæ–‡ä»¶æ”¾åœ¨`QQSyncImages`æ–‡ä»¶å¤¹ä¸‹ã€‚

`SwiftUI`çš„å†…å®¹å¯ä»¥å‚è€ƒæ–¯å¦ç¦è€çˆ·å­çš„æ•™ç¨‹ï¼Œé“¾æ¥å¦‚ä¸‹ï¼š
- https://cs193p.sites.stanford.edu/

å¡«å……å†…å®¹åå¤§è‡´å¦‚ä¸‹ï¼š

``` Swift

struct QQSyncWidgetView: View {
        ZStack {
            // èƒŒæ™¯å›¾ç‰‡
            Image("widget_background_test")
                .resizable()
            
            // å·¦å³ä¸¤ä¸ª View
            HStack {
                Spacer()
                // å·¦ View
                VStack(alignment: .leading) {
                    Spacer()
                    Text("æ‰€æœ‰å¿«ä¹éƒ½å‘ä½ é æ‹¢ï¼Œæ‰€æœ‰å¥½è¿éƒ½åœ¨è·¯ä¸Šã€‚")
                        .font(.system(size: 19.0))
                        .fontWeight(.semibold)
                        .minimumScaleFactor(0.5)
                        .foregroundColor(.white)

                    Spacer()
                    
                    Text("åŠ æ²¹ï¼Œæ‰“å·¥äººï¼ğŸ˜„")
                        .font(.system(size: 16.0))
                        .minimumScaleFactor(0.5)
                        .foregroundColor(.white)
                    Spacer()
                }
                
                Spacer()
                
                // å³ View
                VStack {
                    Spacer()
                    Text("06")
                        .font(.system(size: 50.0))
                        .fontWeight(.semibold)
                        .foregroundColor(.white)
                        .padding(EdgeInsets(top: -10.0, leading: 0.0, bottom: -10.0, trailing: 0.0))
                    Text("06æœˆ å‘¨ä¸€")
                        .lineLimit(1)
                        .minimumScaleFactor(0.5)
                        .font(.system(size: 14.0))
                        .foregroundColor(.white)
                    Spacer()
                    Text("å»åˆ†äº«")
                        .fixedSize()
                        .font(.system(size: 14.0))
                        .padding(EdgeInsets(top: 5.0, leading: 20.0, bottom: 5.0, trailing: 20.0))
                        .background(.white)
                        .foregroundColor(.black)
                        .cornerRadius(12.0)
                    Spacer()
                }
                Spacer()
            }
            .padding(EdgeInsets(top: 0.0, leading: 10.0, bottom: 0.0, trailing: 10.0))
        }
    }

```

ç„¶åä¿®æ”¹å…¥å£ï¼Œæ‰“å¼€`DemoWidget.swift`ï¼Œå…¶ä¸­`DemoWidgetEntryView`æ˜¯ç»„ä»¶æ˜¾ç¤ºçš„ Viewï¼Œæ‰€ä»¥è¿™é‡Œä¿®æ”¹ä¸ºåˆšåˆšåˆ›å»ºçš„`QQSyncWidgetView`ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š

``` Swift

struct DemoWidgetEntryView : View {
    var entry: Provider.Entry

    var body: some View {
        QQSyncWidgetView()
    }
}

```

æ•ˆæœå¦‚ä¸‹ï¼š

<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220606172505.png" width="70%">
</figure>


æ•ˆæœå·²ç»å’Œ QQ åŒæ­¥åŠ©æ‰‹çš„ç±»ä¼¼ï¼Œä½†æ˜¯ä¸Šé¢çš„ä»£ç è¿˜éœ€è¦å†ä¼˜åŒ–ä¸€ä¸‹ï¼Œç±»å¤ªè‡ƒè‚¿ï¼›å¯ä»¥æŠŠæ¯ä¸ª`VStack`å•ç‹¬å°è£…æˆä¸€ä¸ª viewï¼Œä¹Ÿèƒ½æ–¹ä¾¿å¤ç”¨ã€‚åˆ›å»ºSwiftUIView å‘½åä¸º`QQSyncQuoteTextView`ç”¨äºWidgetå·¦åŠè¾¹ çš„ view å±•ç¤ºï¼›åˆ›å»ºå³åŠè¾¹çš„ view å‘½åä¸º`QQSyncDateShareView`ï¼Œæœ€ç»ˆä»£ç ä¸ºï¼š

`QQSyncQuoteTextView`ç±»ï¼š

``` Swift

import SwiftUI

struct QQSyncQuoteTextView: View {
    var body: some View {
        VStack(alignment: .leading) {
            Spacer()
            Text("æ‰€æœ‰å¿«ä¹éƒ½å‘ä½ é æ‹¢ï¼Œæ‰€æœ‰å¥½è¿éƒ½åœ¨è·¯ä¸Šã€‚")
                .font(.system(size: 19.0))
                .fontWeight(.semibold)
                .minimumScaleFactor(0.5)
                .foregroundColor(.white)

            Spacer()
            
            Text("åŠ æ²¹ï¼Œæ‰“å·¥äººï¼ğŸ˜„")
                .font(.system(size: 16.0))
                .minimumScaleFactor(0.5)
                .foregroundColor(.white)
            Spacer()
        }
    }
}

```

`QQSyncDateShareView`ç±»ï¼š

``` Swift

import SwiftUI

struct QQSyncDateShareView: View {
    var body: some View {
        VStack {
            Spacer()
            Text("06")
                .font(.system(size: 50.0))
                .fontWeight(.semibold)
                .foregroundColor(.white)
                .padding(EdgeInsets(top: -10.0, leading: 0.0, bottom: -10.0, trailing: 0.0))
            Text("06æœˆ å‘¨ä¸€")
                .lineLimit(1)
                .minimumScaleFactor(0.5)
                .font(.system(size: 14.0))
                .foregroundColor(.white)
            Spacer()
            Text("å»åˆ†äº«")
                .fixedSize()
                .font(.system(size: 14.0))
                .padding(EdgeInsets(top: 5.0, leading: 20.0, bottom: 5.0, trailing: 20.0))
                .background(.white)
                .foregroundColor(.black)
                .cornerRadius(12.0)
            Spacer()
        }
    }
}

```

æœ€åä¿®æ”¹`QQSyncWidgetView`ä¸ºï¼š

``` Swift

import SwiftUI

struct QQSyncWidgetView: View {
    var body: some View {
        ZStack {
            // èƒŒæ™¯å›¾ç‰‡
            Image("widget_background_test")
                .resizable()
            
            // å·¦å³ä¸¤ä¸ª View
            HStack {
                // å·¦ View
                QQSyncQuoteTextView()
                                
                // å³ View
                QQSyncDateShareView()
            }
            .padding(EdgeInsets(top: 0.0, leading: 10.0, bottom: 0.0, trailing: 10.0))
        }
    }
}

```

ç„¶åå†è¿è¡Œï¼Œå‘ç°æ•ˆæœå’Œä¹‹å‰ç›¸åŒï¼Œbingoã€‚


#### ä¸åŒwidget å°ºå¯¸è®¾ç½®

å†æ¥çœ‹ã€widget å¤§å°çš„è®¾ç½®ã€‘ï¼Œç›®å‰å¼€å‘çš„ Widget åœ¨ Medium å¤§å°æ—¶ï¼Œ æ˜¾ç¤ºæ˜¯æ­£å¥½çš„ï¼Œä½†æ˜¯è¿˜æœ‰Smallå’ŒLargeçš„å¤§å°ï¼Œæ˜¾ç¤ºéƒ½æ˜¯ä¸æ­£å¸¸çš„ï¼Œé‚£è¿™ä¸ªæ˜¯å¦‚ä½•è®¾ç½®çš„å‘¢ï¼Ÿæ€ä¹ˆé’ˆå¯¹ä¸åŒå¤§å°ï¼Œè®¾ç½®æ˜¾ç¤ºä¸åŒçš„å†…å®¹ï¼Ÿ

è®¾ç½®ä¸åŒå¤§å°ä¸åŒå†…å®¹çš„Widgetï¼Œéœ€è¦ä½¿ç”¨`WidgetFamily`ï¼Œä½¿ç”¨éœ€è¦å¯¼å…¥`WidgetKit`ï¼Œæ¯”å¦‚è®¾ç½®Small æ—¶ Meidum çš„å³åŠéƒ¨åˆ†ï¼ŒMedium æ—¶æ˜¾ç¤ºä¸å˜ï¼Œè¦æ€ä¹ˆåšå‘¢ï¼Ÿ

1. åœ¨è¦è®¾ç½®çš„ç±»ä¸­å¯¼å…¥`WidgetKit`
2. å£°æ˜å±æ€§`@Environment(\.widgetFamily) var family: WidgetFamily`
3. ä½¿ç”¨`Switch`æšä¸¾ `family`

æ³¨ï¼š
- `@Environment`æ˜¯ä½¿ç”¨ `SwiftUI`æœ¬èº«é¢„å®šä¹‰çš„keyï¼Œæ›´å¤šå…³äº`@Environment`çš„å†…å®¹å¯ä»¥å‚è€ƒä¸‹é¢ä¸¤ä¸ªé“¾æ¥ï¼š
  - https://developer.apple.com/documentation/swiftui/environment
  - https://www.hackingwithswift.com/quick-start/swiftui/what-is-the-environment-property-wrapper

å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

``` Swift


import SwiftUI
import WidgetKit

struct QQSyncWidgetView: View {
    @Environment(\.widgetFamily) var family: WidgetFamily
    
    var body: some View {
        ZStack {
            // èƒŒæ™¯å›¾ç‰‡
            Image("widget_background_test")
                .resizable()
            switch family {
            case .systemSmall:
                QQSyncDateShareView()
            case .systemMedium:
                // å·¦å³ä¸¤ä¸ª View
                HStack {
                    // å·¦ View
                    QQSyncQuoteTextView()
                                        
                    // å³ View
                    QQSyncDateShareView()
                }
                .padding(EdgeInsets(top: 0.0, leading: 10.0, bottom: 0.0, trailing: 10.0))
//            case .systemLarge:
//                break
//            case .systemExtraLarge:
//                break
            default:
                QQSyncQuoteTextView()
            }
        }
    }
}

```

è¿è¡ŒæŸ¥çœ‹æ•ˆæœï¼Œå¦‚ä¸‹ï¼š

<figure>
    <img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220606172328.png" width="70%">
</figure>

å‘ç°æ•ˆæœå’Œé¢„æœŸä¸€æ ·ï¼Œä½†æ˜¯ä»£ç çœ‹èµ·æ¥çœŸçš„æœ‰ç‚¹ä¸‘ï¼ŒåŒæ ·å†ä¼˜åŒ–ä¸€ä¸‹ï¼Œå°è£…`QQSyncWidgetMedium`å’Œ`QQSyncWidgetSmall`ä¸¤ä¸ªç±»ï¼Œå¦‚ä¸‹ï¼š

``` Swift

import SwiftUI

struct QQSyncWidgetSmall: View {
    var body: some View {
        ZStack {
            // èƒŒæ™¯å›¾ç‰‡
            Image("widget_background_test")
                .resizable()
            
            QQSyncDateShareView()
        }
    }
}

```

``` Swift

import SwiftUI

struct QQSyncWidgetMedium: View {
    var body: some View {
        ZStack {
            // èƒŒæ™¯å›¾ç‰‡
            Image("widget_background_test")
                .resizable()

            // å·¦å³ä¸¤ä¸ª View
            HStack {
                // å·¦ View
                QQSyncQuoteTextView()

                Spacer()

                // å³ View
                QQSyncDateShareView()
            }
            .padding(EdgeInsets(top: 0.0, leading: 20.0, bottom: 0.0, trailing: 20.0))
        }
    }
}

```

ç„¶åä¿®æ”¹`QQSyncWidgetView`ï¼Œå¦‚ä¸‹ï¼š

``` Swift


import SwiftUI
import WidgetKit

struct QQSyncWidgetView: View {
    @Environment(\.widgetFamily) var family: WidgetFamily
    
    var body: some View {
        switch family {
        case .systemSmall:
            QQSyncWidgetSmall()
        case .systemMedium:
            QQSyncWidgetMedium()
//            case .systemLarge:
//                break
//            case .systemExtraLarge:
//                break
        default:
            QQSyncWidgetMedium()
        }
    }
}

```

å†æ¬¡è¿è¡Œï¼ŒæŸ¥çœ‹æ•ˆæœï¼Œè¿˜æ˜¯é¢„æœŸçš„æ•ˆæœï¼Œä½†æ˜¯ä»£ç çœ‹èµ·æ¥ç®€æ´æ˜äº†äº†ï¼Œå¦‚æœæƒ³è¦æ·»åŠ  Large çš„ Viewï¼Œåªéœ€è¦å†å®šä¹‰`QQSyncWidgetLarge`ç±»ï¼Œç„¶ååœ¨ä¸Šé¢è¿™ä¸ªåœ°æ–¹ä½¿ç”¨å³å¯ï¼Œæ–¹ä¾¿å¿«æ·ã€‚

æ¥ç€å†æ¥çœ‹ç¬”è€…åˆ›å»ºçš„é¡¹ç›®ï¼Œæ·»åŠ  Widget æ—¶ï¼Œ`Small`ã€`Meidum`ã€`Large`éƒ½æœ‰ï¼Œå³ä½¿åœ¨ä¸Šé¢çš„`Switch family`ä¸­æ³¨é‡Šæ‰äº†`Small`å’Œ`Larget`ï¼Œé¢„è§ˆæ—¶ä»æ—§è¿™ä¸¤ä¸ªå°ºå¯¸ä»æ—§åœ¨ï¼›è€Œå½“æ·»åŠ QQ åŒæ­¥åŠ©æ‰‹çš„ Widget æ—¶ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„ Widget åªæœ‰ä¸€ä¸ªMediumå°ºå¯¸çš„ï¼Œè¿™åˆæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ

è¿™æ˜¯é€šè¿‡ @main å…¥å£å¤„è®¾ç½®`supportedFamilies`å±æ€§å®ç°çš„ï¼Œ`supportedFamilies`ä¼ å…¥ä¸€ä¸ªå°ºå¯¸æ•°ç»„ï¼Œä¼ å…¥å‡ ä¸ªå°ºå¯¸åˆ™æ”¯æŒå‡ ä¸ªå°ºå¯¸ï¼Œè€Œå‚ç…§ QQ åŒæ­¥åŠ©æ‰‹çš„æ•ˆæœï¼Œåªä¼ å…¥äº†`.systemMedium`å°ºå¯¸ï¼Œä»£ç å¦‚ä¸‹ï¼š

``` Swift

@main
struct DemoWidget: Widget {
    let kind: String = "DemoWidget"

    var body: some WidgetConfiguration {
        StaticConfiguration(kind: kind, provider: Provider()) { entry in
            DemoWidgetEntryView(entry: entry)
        }
        .configurationDisplayName("My Widget")
        .description("This is an example widget.")
        .supportedFamilies([WidgetFamily.systemMedium]) // è®¾ç½®é¢„è§ˆ widget ä¸­æ”¯æŒçš„å°ºå¯¸æ•°ç»„
    }
}

```


#### widget æ—¥æœŸæ›´æ–°

ä¸Šé¢æ˜¾ç¤ºçš„éƒ¨åˆ†å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥ï¼Œå†æ¥çœ‹ã€æ—¥æœŸçš„è®¾ç½®ã€‘ï¼Œç›®å‰çš„æ—¥æœŸæ˜¯å›ºå®šçš„ï¼Œå¦‚ä½•è®©æ—¥æœŸå–ç”¨æ‰‹æœºæ—¶é—´ï¼Œè¦æ€ä¹ˆåšï¼Ÿ

éœ€è¦è€ƒè™‘çš„æ˜¯ï¼š
- æ—¥æœŸä»å“ªé‡Œæ¥ï¼Ÿâ€”â€” å¯ä»¥åœ¨ Extension ä¸­ï¼Œç›´æ¥ä½¿ç”¨ Date()æ¥è·å–åˆ°å½“å‰çš„æ—¥æœŸ
- æ—¥æœŸæ›´æ–°äº†æ€ä¹ˆé€šçŸ¥åˆ·æ–°ï¼Ÿå‚è€ƒ[cs193p-Developing Apps for iOS](https://cs193p.sites.stanford.edu/)ï¼Œä½¿ç”¨`ObservableObject`å®šä¹‰ä¸€ä¸ª`@Published`ä¿®é¥°çš„å±æ€§ï¼Œç„¶ååœ¨ä½¿ç”¨çš„ Viewä¸­ä½¿ç”¨`@ObservedObject`ä¿®é¥°çš„å±æ€§ï¼Œè¿™æ ·å½“`@Published`ä¿®é¥°çš„å±æ€§æœ‰å˜åŒ–æ—¶ï¼Œ`@ObservedObject`ä¿®é¥°çš„å±æ€§å°±ä¼šå˜åŒ–ï¼Œä»è€Œåˆ·æ–°ç•Œé¢ã€‚

ä»£ç å®ç°å¦‚ä¸‹ï¼š

é¦–å…ˆåˆ›å»ºswift æ–‡ä»¶ï¼Œæ³¨æ„ï¼Œmodel ç±»åˆ›å»ºä½¿ç”¨çš„ swiftï¼Œè€Œ UIåˆ›å»ºçš„ç±»æ˜¯ SwiftUIã€‚

æ–°å»º`String_Extensions.swift`ï¼Œå®šä¹‰è·å–æŒ‡å®šæ—¥æœŸç±»å‹çš„å­—ç¬¦ä¸²ï¼Œä»£ç å¦‚ä¸‹ï¼š

``` Swift

import Foundation

enum DisplayDateType {
    case Year
    case Month
    case Day
    case hour
    case minute
    case second
}

extension String {
    func getFormatDateStr(_ type: DisplayDateType) -> String {
        let dateFormatter = DateFormatter()
        dateFormatter.locale = Locale.current
        dateFormatter.dateFormat = "yyyy-MM-dd HH:mm:ss"
        guard let formatDate = dateFormatter.date(from: self) else { return "" }
        let calendar = Calendar.current
        _ = calendar.component(.era, from: formatDate)
        let year = calendar.component(.year, from: formatDate)
        let month = calendar.component(.month, from: formatDate)
        let day = calendar.component(.day, from: formatDate)
        let hour = calendar.component(.hour, from: formatDate)
        let minute = calendar.component(.minute, from: formatDate)
        let second = calendar.component(.second, from: formatDate)
        switch type {
        case .Year:
            return String(format: "%.2zd", year)
        case .Month:
            return String(format: "%.2zd", month)
        case .Day:
            return String(format: "%.2zd", day)
        case .hour:
            return String(format: "%.2zd", hour)
        case .minute:
            return String(format: "%.2zd", minute)
        case .second:
            return String(format: "%.2zd", second)
        }
    }

    
    func getWeekday() -> String {
        let dateFormatter = DateFormatter()
        dateFormatter.locale = Locale.current
        dateFormatter.dateFormat = "yyyy-MM-dd HH:mm:ss"
        guard let formatDate = dateFormatter.date(from: self) else { return "" }
        let calendar = Calendar.current
        let weekDay = calendar.component(.weekday, from: formatDate)
        switch weekDay {
        case 1:
            return "å‘¨æ—¥"
        case 2:
            return "å‘¨ä¸€"
        case 3:
            return "å‘¨äºŒ"
        case 4:
            return "å‘¨ä¸‰"
        case 5:
            return "å‘¨å››"
        case 6:
            return "å‘¨äº”"
        case 7:
            return "å‘¨å…­"
        default:
            return ""
        }
    }
}

```

æ–°å»º`QQSyncWidgetDateItem.swift`ç±»ï¼Œç”¨äºè·å–å¹´ã€æœˆã€æ—¥ã€å‘¨ã€æ—¶ã€åˆ†ã€ç§’çš„ String

``` Swift

import Foundation

struct QQSyncWidgetDateItem {
    var year: String
    var month: String
    var day: String
    
    var week: String
    
    var hour: String
    var minute: String
    var second: String
    
    static func generateItem() -> QQSyncWidgetDateItem {
        let dateStr = date2String(date: Date())
        
        let year = dateStr.getFormatDateStr(DisplayDateType.Year)
        let month = dateStr.getFormatDateStr(DisplayDateType.Month)
        let day = dateStr.getFormatDateStr(DisplayDateType.Day)
        
        let week = dateStr.getWeekday()
        
        let hour = dateStr.getFormatDateStr(DisplayDateType.hour)
        let minute = dateStr.getFormatDateStr(DisplayDateType.minute)
        let second = dateStr.getFormatDateStr(DisplayDateType.second)
        
        let item = QQSyncWidgetDateItem(year: year,
                                     month: month,
                                     day: day,
                                     week: week,
                                     hour: hour,
                                     minute: minute,
                                     second: second)
        return item
    }
    
    static func date2String(date:Date, dateFormat:String = "yyyy-MM-dd HH:mm:ss") -> String {
        let formatter = DateFormatter()
        formatter.locale = Locale.init(identifier: "zh_CN")
        formatter.dateFormat = dateFormat
        let date = formatter.string(from: date)
        return date
    }
}

```

æ–°å»º`QQSyncWidgetDateShareItem.swift`ï¼Œç±»ä¼¼äº Utilï¼ŒæŠŠ model è½¬ä¸º view ç›´æ¥èƒ½æ˜¾ç¤ºçš„é€»è¾‘å’Œå“åº”ç‚¹å‡»çš„é€»è¾‘éƒ½å¯ä»¥æ”¾å…¥è¿™ä¸ªç±»

``` Swift

import Foundation
import SwiftUI


class QQSyncWidgetDateShareItem: ObservableObject {
    
    @Published private var dateItem = QQSyncWidgetDateItem.generateItem()
    
    
    func dateShareStr() -> String {
        let resultStr = dateItem.month + "æœˆ " + dateItem.week
        return resultStr
    }
    
    func dayStr() -> String {
        return dateItem.day
    }
    
    // MARK: action

}

```

ç„¶åä¿®æ”¹`QQSyncDateShareView`ç±»ï¼Œæ·»åŠ `QQSyncWidgetDateShareItem`å±æ€§ï¼Œå›ºå®šçš„æ—¥æœŸæ”¹ä¸ºä»`QQSyncWidgetDateShareItem`è·å–

``` Swift

import SwiftUI

struct QQSyncDateShareView: View {
    @ObservedObject var dateShareItem: QQSyncWidgetDateShareItem
    
    var body: some View {
        VStack {
            Spacer()
            Text(dateShareItem.dayStr())
                .font(.system(size: 50.0))
                .fontWeight(.semibold)
                .foregroundColor(.white)
                .padding(EdgeInsets(top: -10.0, leading: 0.0, bottom: -10.0, trailing: 0.0))
            Text(dateShareItem.dateShareStr())
                .lineLimit(1)
                .minimumScaleFactor(0.5)
                .font(.system(size: 14.0))
                .foregroundColor(.white)
            Spacer()
            Text("å»åˆ†äº«")
                .fixedSize()
                .font(.system(size: 14.0))
                .padding(EdgeInsets(top: 5.0, leading: 20.0, bottom: 5.0, trailing: 20.0))
                .background(.white)
                .foregroundColor(.black)
                .cornerRadius(12.0)
            Spacer()
        }
    }
}

```

ç„¶åä¿®æ”¹æœ‰è°ƒç”¨`QQSyncDateShareView`çš„åœ°æ–¹ï¼Œ`QQSyncWidgetSmall`ã€`QQSyncWidgetMedium`ä¸­éƒ½æ·»åŠ å±æ€§å£°æ˜ä»£ç ï¼Œå¹¶ä¸”ä¿®æ”¹ä¼ å…¥å‚æ•°ï¼›ç„¶åä¿®æ”¹æœ‰å¼•ç”¨è¿™ä¸¤ä¸ªç±»çš„åœ°æ–¹å³`QQSyncWidgetView`ï¼Œä¹Ÿæ·»åŠ å±æ€§å£°æ˜ä¿®æ”¹ä¼ å…¥å‚æ•°ï¼›æœ€åå†ä¿®æ”¹`DemoWidget`ç±»ä¸­ä½¿ç”¨äº†`DemoWidgetEntryView`çš„åœ°æ–¹ï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š

``` Swift

struct DemoWidgetEntryView : View {
    var entry: Provider.Entry

    var body: some View {
        QQSyncWidgetView(dateShareItem: QQSyncWidgetDateShareItem())
    }
}

```

æœ€åä¿®æ”¹åˆ·æ–°æ—¶æœºï¼Œå³ä½•æ—¶åˆ·æ–° widget æ•°æ®ï¼Œæ˜¯`TimeLineProvider`ä¸­çš„`getTimeline(in context: Context, completion: @escaping (Timeline<Entry>) -> ())`æ–¹æ³•æ§åˆ¶çš„ï¼Œä¿®æ”¹æˆæ¯éš”2ä¸ªå°æ—¶åˆ·æ–°ã€‚

``` Swift

    func getTimeline(in context: Context, completion: @escaping (Timeline<Entry>) -> ()) {
        let entry = SimpleEntry(date: Date())
        // refresh the data every two hours
        let expireDate = Calendar.current.date(byAdding: .hour, value: 2, to: Date()) ?? Date()
        let timeline = Timeline(entries: [entry], policy: .after(expireDate))
        completion(timeline)
    }

```

ç„¶åè¿è¡Œè°ƒè¯•ï¼Œä¿®æ”¹æ—¥æœŸï¼Œå°±ä¼šå‘ç°ï¼Œwidget å±•ç¤ºçš„æ—¥æœŸæ•°æ®éšç€æ‰‹æœºæ—¥æœŸçš„ä¿®æ”¹ä¹Ÿè·Ÿç€å˜äº†ï¼Œdoneã€‚

#### widget ç½‘ç»œæ•°æ®é€»è¾‘

å¯¹æ¯” QQ åŒæ­¥åŠ©æ‰‹çš„ Widgetï¼Œå¯ä»¥å‘ç°ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå›¾ç‰‡å’Œæ–‡å­—å°±è‡ªåŠ¨å˜åŒ–äº†ä¸€æ¬¡ã€‚æ¥ä¸‹æ¥ä¸€èµ·çœ‹ä¸‹è¿™ä¸ªæ•ˆæœæ€ä¹ˆåšï¼ŒèƒŒæ™¯å›¾ç‰‡çš„å˜åŒ–å’Œæ–‡å­—çš„å˜åŒ–ç±»ä¼¼éƒ½æ˜¯ç½‘ç»œè¯·æ±‚ï¼Œç„¶åæ›´æ–°æ•°æ®ï¼Œè¿™é‡Œå°±ä»…ä»¥æ–‡å­—çš„æ›´æ–°ä½œä¸ºç¤ºä¾‹ã€‚

é¦–å…ˆæ‰¾ä¸€ä¸ªéšæœºåè¨€çš„æ¥å£ï¼Œå¯ä»¥å‚è€ƒhttps://github.com/vv314/quotesï¼Œè¿™é‡Œé€‰æ‹©é‡Œé¢ä¸€è¨€çš„æ¥å£ï¼Œæ¥å£ä¸ºï¼šhttps://v1.hitokoto.cn/ã€‚æ¥å£æ‰¾å¥½ä¹‹åï¼Œæ¥çœ‹ä¸‹ widget ç½‘ç»œè¯·æ±‚æ€ä¹ˆå®ç°ã€‚

æ–°å»º Network æ–‡ä»¶å¤¹ï¼Œåœ¨ Networkæ–‡ä»¶å¤¹ä¸‹æ–°å»º`NetworkClient.swift`ï¼Œç”¨äºå°è£…`URLSession`ç½‘ç»œè¯·æ±‚ï¼Œä»£ç å¦‚ä¸‹ï¼š

``` Swift

import Foundation

public final class NetworkClient {
    private let session: URLSession = .shared
    
    enum NetworkError: Error {
        case noData
    }
    
    func executeRequest(request: URLRequest, completion: @escaping (Result<Data, Error>) -> Void) {
        session.dataTask(with: request) { data, response, error in
            if let error = error {
                completion(.failure(error))
                return
            }
            
            guard let data = data else {
                completion(.failure(NetworkError.noData))
                return
            }
            
            completion(.success(data))
        }.resume()
    }
}

```

åœ¨ Networkæ–‡ä»¶å¤¹ä¸‹æ–°å»º`URLRequest+Quote.swift`ï¼Œç”¨äºç”ŸæˆQuote çš„ URLRequestï¼Œä»£ç å¦‚ä¸‹ï¼š

``` Swift

import Foundation

extension URLRequest {
    private static var baseURLStr: String { return "https://v1.hitokoto.cn/" }
    
    static func quoteFromNet() -> URLRequest {
        .init(url: URL(string: baseURLStr)!)
    }
}

```

ç„¶åå‚ç…§è¿”å›æ•°æ®æ ¼å¼ï¼Œåˆ›å»ºè¿”å›çš„ model ç±»ï¼Œåˆ›å»º`QuoteResItem.swift`ï¼Œè¿”å›æ•°æ®ä¸­åªç”¨åˆ°äº† hitokotoå­—æ®µï¼Œæ‰€ä»¥åªéœ€è¦å®šä¹‰è¿™ä¸ªå­—æ®µå³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š

``` Swift

import Foundation

struct QuoteResItem: Codable {
    /**
     "id": 6325,
     "uuid": "2017e206-f81b-48c1-93e3-53a63a9de199",
     "hitokoto": "è‡ªè´£è¦çŸ­æš‚ï¼Œä¸è¿‡è¦é•¿ä¹…é“­è®°ã€‚",
     "type": "h",
     "from": "å½“ä½ æ²‰ç¡æ—¶",
     "from_who": null,
     "creator": "æ²ˆæ—¶ç­ ",
     "creator_uid": 6568,
     "reviewer": 1,
     "commit_from": "web",
     "created_at": "1593237879",
     "length": 14
     */
    var hitokoto: String

    // é»˜è®¤ç”Ÿæˆå¯¹è±¡
    static func generateItem() -> QuoteResItem {
        let item = QuoteResItem(hitokoto: "æ‰€æœ‰å¿«ä¹éƒ½å‘ä½ é æ‹¢ï¼Œæ‰€æœ‰å¥½è¿éƒ½åœ¨è·¯ä¸Š")
        return item
    }
}

```

å†åœ¨åœ¨ Networkæ–‡ä»¶å¤¹ä¸‹æ–°å»º`QuoteService.swift`ï¼Œå®šä¹‰å¤–éƒ¨è°ƒç”¨çš„æ¥å£ï¼Œå†…éƒ¨å°è£…è¯·æ±‚é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š

``` Swift

import Foundation

public struct QuoteService {
    static func getQuote(client: NetworkClient, completion: ((QuoteResItem) -> Void)?) {
        quoteRequest(.quoteFromNet(),
                     on: client,
                     completion: completion)
    }
    
    private static func quoteRequest(_ request: URLRequest,
                                     on client: NetworkClient,
                                     completion: ((QuoteResItem) -> Void)?) {
        client.executeRequest(request: request) { result in
            switch result {
            case .success(let data):
                let decoder = JSONDecoder()
                do {
                    let quoteItem = try decoder.decode(QuoteResItem.self, from: data)
                    completion?(quoteItem)
                } catch {
                    print(error.localizedDescription)
                }
            case .failure(let error):
                print(error.localizedDescription)
            }
        }
    }
}

```

ç„¶åæ·»åŠ è°ƒç”¨çš„å…¥å£ï¼Œåœ¨æ·»åŠ è°ƒç”¨ä¹‹å‰ï¼Œéœ€è¦è€ƒè™‘ä¸‹ä½¿ç”¨çš„åœºæ™¯ï¼Œå’Œæ—¥æœŸç›¸åŒï¼Œå®šä¹‰ä¸€ä¸ª Publishedä¿®é¥°çš„å±æ€§ï¼Œç„¶ååœ¨ä½¿ç”¨çš„åœ°æ–¹ï¼Œä½¿ç”¨å®šä¹‰@ObservedObjectä¿®é¥°çš„å±æ€§æ¥ç›‘å¬å˜åŒ–ã€‚

åˆ›å»º`QQSyncWidgetQuoteShareItem.swift`ï¼Œç”¨äºå¤„ç† Quoteçš„æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š

``` Swift

import Foundation

class QQSyncWidgetQuoteShareItem: ObservableObject {
    @Published private var quoteItem = QuoteResItem.generateItem()
    
    func quoteStr() -> String {
        return quoteItem.hitokoto
    }
    
    func updateQuoteItem(_ item: QuoteResItem) {
        self.quoteItem = item
    }
}

```

åœ¨`QQSyncQuoteTextView.swift`ä¸­æ·»åŠ å±æ€§ï¼Œå¹¶ä¿®æ”¹ä½¿ç”¨ï¼Œä»£ç å¦‚ä¸‹

``` Swift

import SwiftUI

struct QQSyncQuoteTextView: View {
    @ObservedObject var quoteShareItem: QQSyncWidgetQuoteShareItem
    
    var body: some View {
        VStack(alignment: .leading) {
            Spacer()
            Text(quoteShareItem.quoteStr())
                .font(.system(size: 19.0))
                .fontWeight(.semibold)
                .minimumScaleFactor(0.5)
                .foregroundColor(.white)

            Spacer()
            
            Text("åŠ æ²¹ï¼Œæ‰“å·¥äººï¼ğŸ˜„")
                .font(.system(size: 16.0))
                .minimumScaleFactor(0.5)
                .foregroundColor(.white)
            Spacer()
        }
    }
}

```

ç„¶åä¿®æ”¹`QQSyncWidgetMedium.swift`å’Œ`QQSyncWidgetView.swift`ä¸­çš„æŠ¥é”™ï¼Œå’Œä¸Šé¢ç±»ä¼¼ï¼Œæ·»åŠ `@ObservedObject var quoteShareItem: QQSyncWidgetQuoteShareItem`ï¼Œä¿®æ”¹ä¼ å…¥å‚æ•°ã€‚

æœ€åå†ä¿®æ”¹`DemoWidget.swift`
- ä¿®æ”¹`SimpleEntry`ï¼Œæ·»åŠ å®šä¹‰çš„`QQSyncWidgetQuoteShareItem`å±æ€§
- ä¿®æ”¹`DemoWidgetEntryView`ï¼Œæ·»åŠ ä¼ å…¥å‚æ•°`entry.quoteShareItem`
- ä¿®æ”¹`Provider`
  - `placeholder(in context: Context) -> SimpleEntry`æ·»åŠ ä¼ å…¥å‚æ•°ï¼Œä½¿ç”¨é»˜è®¤å€¼
  - `getSnapshot(in context: Context, completion: @escaping (SimpleEntry) -> ())`æ·»åŠ ä¼ å…¥å‚æ•°ï¼Œä½¿ç”¨é»˜è®¤å€¼
  - `getTimeline(in context: Context, completion: @escaping (Timeline<Entry>) -> ())`æ–¹æ³•â€”â€”æ·»åŠ ç½‘ç»œè¯·æ±‚çš„è°ƒç”¨ï¼Œç”¨ç½‘ç»œè¿”å›å¯¹è±¡ç”Ÿæˆå¯¹åº”çš„`QQSyncWidgetQuoteShareItem`ï¼Œä¼ å…¥å‚æ•°ä½¿ç”¨ç”Ÿæˆçš„ item

ä»£ç å¦‚ä¸‹ï¼š

``` Swift

struct Provider: TimelineProvider {
    func placeholder(in context: Context) -> SimpleEntry {
        SimpleEntry(date: Date(), quoteShareItem: QQSyncWidgetQuoteShareItem())
    }

    func getSnapshot(in context: Context, completion: @escaping (SimpleEntry) -> ()) {
        let entry = SimpleEntry(date: Date(), quoteShareItem: QQSyncWidgetQuoteShareItem())
        completion(entry)
    }

    func getTimeline(in context: Context, completion: @escaping (Timeline<Entry>) -> ()) {
        QuoteService.getQuote(client: NetworkClient()) { quoteResItem in
            let quoteShareItem = QQSyncWidgetQuoteShareItem()
            quoteShareItem.updateQuoteItem(quoteResItem)
            let entry = SimpleEntry(date: Date(), quoteShareItem: quoteShareItem)
            // refresh the data every two hours
            let expireDate = Calendar.current.date(byAdding: .hour, value: 2, to: Date()) ?? Date()
            let timeline = Timeline(entries: [entry], policy: .after(expireDate))
            completion(timeline)
        }
    }
}

struct SimpleEntry: TimelineEntry {
    let date: Date
    
    var quoteShareItem: QQSyncWidgetQuoteShareItem
}

struct DemoWidgetEntryView : View {
    var entry: Provider.Entry

    var body: some View {
        QQSyncWidgetView(dateShareItem: QQSyncWidgetDateShareItem(), quoteShareItem: entry.quoteShareItem)
    }
}

```

è°ƒè¯•æŸ¥çœ‹æ•ˆæœï¼Œå¯ä»¥çœ‹åˆ°æ˜¾ç¤ºçš„æ–‡æ¡ˆå·²ç»æ”¹å˜ï¼Œè¯´æ˜å·²ç»ä½¿ç”¨äº†ç½‘ç»œè¿”å›çš„æ•°æ®ï¼›è¿˜å¯ä»¥æµ‹è¯•ä¸€ä¸‹ widget åˆ·æ–°çš„æ—¶æœºï¼Œä¸Šé¢çš„ä»£ç ä¸­è®¾ç½®äº†æ¯éš”ä¸¤ä¸ªå°æ—¶åˆ·æ–°ä¸€ä¸‹ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæ‰‹æœºæ—¶é—´è°ƒåä¸¤ä¸ªå°æ—¶ï¼Œç„¶åå†æ¥æŸ¥çœ‹ä¸‹ widget æ•ˆæœï¼Œå¯ä»¥å‘ç°æ–‡å­—å‘ç”Ÿäº†æ”¹å˜ï¼Œè¯´æ˜åˆ·æ–°äº†æ•°æ®ï¼Œèµï¼Œå®Œæˆã€‚


æœ€ç»ˆå®Œæ•´æ•ˆæœå¦‚ä¸‹ï¼š

![æœ€ç»ˆæ•ˆæœ](https://raw.githubusercontent.com/mokong/BlogImages/main/img/RPReplay_Final1654600687.gif)

å®Œæ•´ä»£ç å·²æ”¾åœ¨ï¼š[Github](https://github.com/mokong/WidgetAllInOne)ä¸­ `Tutorial2-QQ åŒæ­¥åŠ©æ‰‹ widget`ï¼Œé“¾æ¥ï¼šhttps://github.com/mokong/WidgetAllInOne


ä¸‹ä¸€ç¯‡ï¼Œ ä¼šå…ˆè®² WidgetGroup çš„ä½¿ç”¨ï¼Œç„¶åå†è®²æ€ä¹ˆå®ç°ä¸€ä¸ªæ”¯ä»˜å® Widgetæ•ˆæœã€‚


## å‚è€ƒ

- [cs193p-Developing Apps for iOS](https://cs193p.sites.stanford.edu/)
- [Environment](https://developer.apple.com/documentation/swiftui/environment)
- [What is the @Environment property wrapper?](https://www.hackingwithswift.com/quick-start/swiftui/what-is-the-environment-property-wrapper)
- [Appä¹‹é—´çš„æ•°æ®å…±äº«â€”â€”App Groupçš„é…ç½®](https://www.jianshu.com/p/94d4106b9298)
- [Making a Configurable Widget](https://developer.apple.com/documentation/widgetkit/making-a-configurable-widget)
- [Create a Tube Status home-screen Widget for iOS 14](https://www.oliverbinns.co.uk/2020/06/27/create-a-tube-status-home-screen-widget-for-ios-14/)
- [Reorderable intent configuration widget iOS](https://stackoverflow.com/questions/65558991/reorderable-intent-configuration-widget-ios)

